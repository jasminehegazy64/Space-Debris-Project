<html>
  <head>
    <title>Messages</title>
    <meta charset="utf-8" />
    <meta name="robots" content="index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}" />
    <style>
      .container {
        max-width: 100%;
        overflow-x: auto;
      }
      
      table {
        width: 100%;
        border-collapse: collapse;
      }
      
      th,
      td {
        padding: 8px;
        text-align: left;
        border-bottom: 1px solid #ddd;
      }
      
      th {
        background-color: #f2f2f2;
      }
    </style>
  </head>

  <body class="subpage">
    <!-- Header -->
    <header id="header">
      <div class="inner">
        <a href="{{ url_for('index') }}" class="logo"><img src="{{ url_for('static', filename='images/logo.png') }}" alt="logo" width="45" height="43" /></a>
        <nav id="nav">
          <a href="{{ url_for('admindashboard') }}">Admin Dashboard</a>
          <a href="{{ url_for('admin_users') }}">Users</a>
          <a href="{{ url_for('messages') }}">Messages</a>
          <a href="{{ url_for('allreports') }}">Reports</a>
        </nav><a href="#navPanel" class="navPanelToggle"><span class="fa fa-bars"></span></a>
      </div>
    </header>

    <section id="banner">
      <h1>All Messages</h1>
    </section>
    <br />

    <div class="table-wrapper">
      <div class="container">
        <table>
          <!-- Modify your table section in messages.html -->
<div class="table-wrapper">
  <div class="container">
    <table>
      <tr>
        <th>Message ID</th>
        <th>User Name</th>
        <th>Email</th>
        <th>Message</th>
        <th>Reply</th>
        <th>Delete</th>
      </tr>
      {% for message in messages %}
      <tr>
        <td>{{ message.id }}</td>
        <td>{{ message.name }}</td>
        <td>{{ message.email }}</td>
        <td>{{ message.message }}</td>
        <td class="reply-cell">
          <form class="reply-form" data-message-id="{{ message.id }}">
            <input type="text" name="reply_message" placeholder="Reply message">
            <input type="submit" value="Reply">
          </form>
        </td>
        <td>
          <form class="delete-form" data-message-id="{{ message.id }}">
            <input type="submit" value="Delete">
          </form>
        </td>

      </tr>
      {% endfor %}
    </table>
  </div>
</div>

      </div>
    </div>
    <br />
    
    <!-- Footer -->
    <footer id="footer">
      <div class="inner">
        <div class="flex">
          <ul class="icons">
            <li>
              <a href="#" class="icon fa-facebook"><span class="label">Facebook</span></a>
            </li>
            <li>
              <a href="#" class="icon fa-twitter"><span class="label">Twitter</span></a>
            </li>
            <li>
              <a href="#" class="icon fa-linkedin"><span class="label">linkedIn</span></a>
            </li>
            <li>
              <a href="#" class="icon fa-pinterest-p"><span class="label">Pinterest</span></a>
            </li>
            <li>
              <a href="#" class="icon fa-vimeo"><span class="label">Vimeo</span></a>
            </li>
          </ul>
        </div>
      </div>
    </footer>
    <div class="copyright">ESPACIO : Detecting, Tracking, and Collision Prediction of Space Debris</div>

    <!-- Scripts -->
    <script src="{{ url_for('static', filename='js/jquery.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/skel.min.js') }}"></script>
    <script src="{{ url_for('static', filename='js/util.js') }}"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
  </body>
</html>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
  $(document).ready(function() {
    // Handle reply form submission via AJAX
    $('.reply-form').submit(function(event) {
      event.preventDefault();
      var messageID = $(this).data('message-id');
      var replyMessage = $(this).find('input[name="reply_message"]').val();
      
      $.ajax({
        type: 'POST',
        url: `/reply_message/${messageID}`, 
        data: { reply_message: replyMessage },
        success: function(response) {
          alert(response.message); 
          $('#message-' + messageID).remove();
          // Remove the message row from the table upon success
          location.reload();// Display success message (adjust as needed)
          // Optionally update the UI or perform other actions upon success
        },
        error: function(xhr, status, error) {
          alert('An error occurred while processing your request.');
          console.error(error);
        }
      });
    });

    // Handle delete form submission via AJAX
    $('.delete-form').submit(function(event) {
      event.preventDefault();
      var messageID = $(this).data('message-id');
      
      $.ajax({
        type: 'POST',
        url: `/delete_message/${messageID}`,
        success: function(response) {
          alert(response.message); // Display success message (adjust as needed)
          // Remove the message row from the table upon success
          $('#message-' + messageID).remove();
          location.reload();

        },
        error: function(xhr, status, error) {
          alert('An error occurred while processing your request.');
          console.error(error);
        }
      });
    });
  });
  
</script>
